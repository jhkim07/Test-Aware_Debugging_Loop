{"instance_id": "astropy__astropy-12907", "model_patch": "--- a/astropy/modeling/tests/test_separable.py\n+++ b/astropy/modeling/tests/test_separable.py\n@@ -131,6 +131,16 @@\n @pytest.mark.parametrize(('compound_model', 'result'), compound_models.values())\n def test_separable(compound_model, result):\n+\n+\n+def test_separability_nested_compound_model():\n+    cm = m.Linear1D(10) & m.Linear1D(5)\n+    result = separability_matrix(m.Pix2Sky_TAN() & cm)\n+    expected_result = np.array([[ True,  True, False, False],\n+                                [ True,  True, False, False],\n+                                [False, False,  True,  True],\n+                                [False, False,  True,  True]])\n+    assert_allclose(result, expected_result)\n     assert_allclose(is_separable(compound_model), result[0])\n     assert_allclose(separability_matrix(compound_model), result[1])\n\n--- a/astropy/modeling/separable.py\n+++ b/astropy/modeling/separable.py\n@@ -242,6 +242,34 @@\n         cright = _coord_matrix(right, 'right', noutp)\n     else:\n         cright = np.zeros((noutp, right.shape[1]))\n+        cright[-right.shape[0]:, -right.shape[1]:] = right\n+\n+    return np.hstack([cleft, cright])\n+    \"\"\"\n+    Function corresponding to '&' operation.\n+\n+    Parameters\n+    ----------\n+    left, right : `astropy.modeling.Model` or ndarray\n+        If input is of an array, it is the output of `coord_matrix`.\n+\n+    Returns\n+    -------\n+    result : ndarray\n+        Result from this operation.\n+\n+    \"\"\"\n+    noutp = _compute_n_outputs(left, right)\n+\n+    if isinstance(left, Model):\n+        cleft = _coord_matrix(left, 'left', noutp)\n+    else:\n+        cleft = np.zeros((noutp, left.shape[1]))\n+        cleft[: left.shape[0], : left.shape[1]] = left\n+    if isinstance(right, Model):\n+        cright = _coord_matrix(right, 'right', noutp)\n+    else:\n+        cright = np.zeros((noutp, right.shape[1]))\n         cright[-right.shape[0]:, -right.shape[1]:] = 1\n\n     return np.hstack([cleft, cright])\n", "model_name_or_path": "test-aware-debugging"}
