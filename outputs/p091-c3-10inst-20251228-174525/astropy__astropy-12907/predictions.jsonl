{"instance_id": "astropy__astropy-12907", "model_patch": "--- a/astropy/modeling/tests/test_separable.py\n+++ b/astropy/modeling/tests/test_separable.py\n@@ -114,6 +114,24 @@\n def test_arith_oper():\n+def test_nested_compound_models_separability():\n+    cm = models.Linear1D(10) & models.Linear1D(5)\n+    expected_cm = np.array([[True, False], [False, True]])\n+    assert_allclose(separability_matrix(cm), expected_cm)\n+\n+    cm_complex = models.Pix2Sky_TAN() & models.Linear1D(10) & models.Linear1D(5)\n+    expected_cm_complex = np.array([[True, True, False, False],\n+                                    [True, True, False, False],\n+                                    [False, False, True, False],\n+                                    [False, False, False, True]])\n+    assert_allclose(separability_matrix(cm_complex), expected_cm_complex)\n+\n+    cm_nested = models.Pix2Sky_TAN() & cm\n+    expected_cm_nested = np.array([[True, True, False, False],\n+                                   [True, True, False, False],\n+                                   [False, False, True, True],\n+                                   [False, False, True, True]])\n+    assert_allclose(separability_matrix(cm_nested), expected_cm_nested)\n     # Models as inputs\n     result = _arith_oper(sh1, scl1)\n     assert_allclose(result, np.array([[1]]))\n\n--- a/astropy/modeling/separable.py\n+++ b/astropy/modeling/separable.py\n@@ -242,6 +242,34 @@\n         cright = _coord_matrix(right, 'right', noutp)\n     else:\n         cright = np.zeros((noutp, right.shape[1]))\n+        cright[-right.shape[0]:, -right.shape[1]:] = right\n+\n+    return np.hstack([cleft, cright])\n+    \"\"\"\n+    Function corresponding to '&' operation.\n+\n+    Parameters\n+    ----------\n+    left, right : `astropy.modeling.Model` or ndarray\n+        If input is of an array, it is the output of `coord_matrix`.\n+\n+    Returns\n+    -------\n+    result : ndarray\n+        Result from this operation.\n+\n+    \"\"\"\n+    noutp = _compute_n_outputs(left, right)\n+\n+    if isinstance(left, Model):\n+        cleft = _coord_matrix(left, 'left', noutp)\n+    else:\n+        cleft = np.zeros((noutp, left.shape[1]))\n+        cleft[: left.shape[0], : left.shape[1]] = left\n+    if isinstance(right, Model):\n+        cright = _coord_matrix(right, 'right', noutp)\n+    else:\n+        cright = np.zeros((noutp, right.shape[1]))\n         cright[-right.shape[0]:, -right.shape[1]:] = 1\n\n     return np.hstack([cleft, cright])\n", "model_name_or_path": "test-aware-debugging"}
