{"instance_id": "astropy__astropy-12907", "model_patch": "--- a/astropy/modeling/tests/test_separable.py\n+++ b/astropy/modeling/tests/test_separable.py\n@@ -136,6 +136,20 @@\n def test_custom_model_separable():\n+\n+\n+def test_separability_matrix_for_nested_compound_models():\n+    cm = models.Linear1D(10) & models.Linear1D(5)\n+    expected_matrix_cm = np.array([[True, False],\n+                                   [False, True]])\n+    assert_allclose(separability_matrix(cm), expected_matrix_cm)\n+\n+    nested_cm = models.Pix2Sky_TAN() & cm\n+    expected_matrix_nested_cm = np.array([[True, True, False, False],\n+                                          [True, True, False, False],\n+                                          [False, False, True, True],\n+                                          [False, False, True, True]])\n+    assert_allclose(separability_matrix(nested_cm), expected_matrix_nested_cm)\n     @custom_model\n     def model_a(x):\n         return x\n\n--- a/astropy/modeling/separable.py\n+++ b/astropy/modeling/separable.py\n@@ -242,7 +242,7 @@\n         cright = _coord_matrix(right, 'right', noutp)\n     else:\n         cright = np.zeros((noutp, right.shape[1]))\n-        cright[-right.shape[0]:, -right.shape[1]:] = 1\n+cright[-right.shape[0]:, -right.shape[1]:] = right\n\n     return np.hstack([cleft, cright])\n", "model_name_or_path": "test-aware-debugging"}
