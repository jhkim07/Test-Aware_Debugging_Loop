{"instance_id": "astropy__astropy-12907", "model_patch": "--- a/astropy/modeling/tests/test_separable.py\n+++ b/astropy/modeling/tests/test_separable.py\n@@ -136,6 +136,27 @@\n def test_custom_model_separable():\n+\n+\n+def test_nested_compound_model_separable():\n+    cm = models.Linear1D(10) & models.Linear1D(5)\n+    expected_matrix_1 = np.array([[True, False],\n+                                  [False, True]])\n+    assert_allclose(separability_matrix(cm), expected_matrix_1)\n+\n+    complex_model = models.Pix2Sky_TAN() & models.Linear1D(10) & models.Linear1D(5)\n+    expected_matrix_2 = np.array([[True, True, False, False],\n+                                  [True, True, False, False],\n+                                  [False, False, True, False],\n+                                  [False, False, False, True]])\n+    assert_allclose(separability_matrix(complex_model), expected_matrix_2)\n+\n+    nested_model = models.Pix2Sky_TAN() & cm\n+    expected_matrix_3 = np.array([[True, True, False, False],\n+                                  [True, True, False, False],\n+                                  [False, False, True, True],\n+                                  [False, False, True, True]])\n+    assert_allclose(separability_matrix(nested_model), expected_matrix_3)\n     @custom_model\n     def model_a(x):\n         return x\n\n--- a/astropy/modeling/separable.py\n+++ b/astropy/modeling/separable.py\n@@ -242,6 +242,34 @@\n         cright = _coord_matrix(right, 'right', noutp)\n     else:\n         cright = np.zeros((noutp, right.shape[1]))\n+        cright[-right.shape[0]:, -right.shape[1]:] = right\n+\n+    return np.hstack([cleft, cright])\n+    \"\"\"\n+    Function corresponding to '&' operation.\n+\n+    Parameters\n+    ----------\n+    left, right : `astropy.modeling.Model` or ndarray\n+        If input is of an array, it is the output of `coord_matrix`.\n+\n+    Returns\n+    -------\n+    result : ndarray\n+        Result from this operation.\n+\n+    \"\"\"\n+    noutp = _compute_n_outputs(left, right)\n+\n+    if isinstance(left, Model):\n+        cleft = _coord_matrix(left, 'left', noutp)\n+    else:\n+        cleft = np.zeros((noutp, left.shape[1]))\n+        cleft[: left.shape[0], : left.shape[1]] = left\n+    if isinstance(right, Model):\n+        cright = _coord_matrix(right, 'right', noutp)\n+    else:\n+        cright = np.zeros((noutp, right.shape[1]))\n         cright[-right.shape[0]:, -right.shape[1]:] = 1\n\n     return np.hstack([cleft, cright])\n", "model_name_or_path": "test-aware-debugging"}
