#!/bin/bash
# Phase 1 í…ŒìŠ¤íŠ¸ ëª¨ë‹ˆí„°ë§ ìŠ¤í¬ë¦½íŠ¸

LOG_FILE=$(ls -t logs/p10-phase1-test-*.log 2>/dev/null | head -1)
OUTPUT_DIR=$(find outputs -name "*p10-phase1*" -type d 2>/dev/null | head -1)

echo "=== Phase 1 í…ŒìŠ¤íŠ¸ ëª¨ë‹ˆí„°ë§ ==="
echo ""

if [ -z "$LOG_FILE" ]; then
    echo "âŒ ë¡œê·¸ íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."
    exit 1
fi

echo "ğŸ“‹ ë¡œê·¸ íŒŒì¼: $LOG_FILE"
echo "ğŸ“ ì¶œë ¥ ë””ë ‰í† ë¦¬: ${OUTPUT_DIR:-ì—†ìŒ}"
echo ""

# í”„ë¡œì„¸ìŠ¤ í™•ì¸
if pgrep -f "p10-phase1" > /dev/null; then
    echo "âœ… í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘..."
    echo ""
    echo "ìµœê·¼ ë¡œê·¸ (ë§ˆì§€ë§‰ 30ì¤„):"
    echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
    tail -30 "$LOG_FILE"
    echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
else
    echo "â¹ï¸  í…ŒìŠ¤íŠ¸ê°€ ì™„ë£Œë˜ì—ˆê±°ë‚˜ ì‹¤í–‰ ì¤‘ì´ ì•„ë‹™ë‹ˆë‹¤."
    echo ""
    echo "ìµœì¢… ë¡œê·¸:"
    echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
    tail -50 "$LOG_FILE"
    echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
    
    # ê²°ê³¼ í™•ì¸
    if [ -n "$OUTPUT_DIR" ]; then
        echo ""
        echo "ğŸ“Š ê²°ê³¼ íŒŒì¼:"
        ls -lh "$OUTPUT_DIR"/*.json* 2>/dev/null | head -5
    fi
fi

echo ""
echo "ê³„ì† ëª¨ë‹ˆí„°ë§í•˜ë ¤ë©´: watch -n 10 ./monitor_phase1_test.sh"

